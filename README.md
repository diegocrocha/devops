# DevOps Infrastructure

This repository contains an example infrastructure definition using Terraform for provisioning AWS resources and Ansible for configuring a Go based event-driven application.

## Prerequisites

- **Terraform** >= 1.0
- **Ansible** >= 2.9
- **AWS credentials** configured locally (via `aws configure` or environment variables)
- SSH access to the provisioned EC2 instance

## Running Terraform

```bash
cd terraform
terraform init
terraform apply
```

`terraform apply` will output the public IP of the created instance and the path to the generated private SSH key. Use this IP when updating the Ansible inventory.

## Running Ansible

Edit `ansible/inventory.ini` so the `app` host points to the EC2 public IP and references the SSH key generated by Terraform. Then run:

```bash
cd ansible
ansible-playbook -i inventory.ini playbook.yml
```

The playbook installs Go, clones the application repository, compiles the binary and creates a systemd service to run it automatically.

## Event-driven architecture

The deployed Go application publishes and consumes events through Kafka. The Ansible role does not install Kafka itself; it assumes you have access to an existing Kafka cluster. Configuration values such as broker addresses and topics can be adjusted in the application's configuration file after deployment.

### Kafka configuration files

The application expects a configuration file similar to the following in `/opt/eventdriven-go/config.yml`:

```yaml
kafka:
  brokers:
    - "localhost:9092"
  topic: "events"
```

Adjust the `brokers` list to point to your Kafka servers. Restart the `eventdriven` service after any change.

### Producing and consuming events

Once Kafka is running and the application is deployed you can test the event flow using the standard Kafka command line tools:

```bash
# Produce a message
kafka-console-producer.sh --broker-list localhost:9092 --topic events

# Consume messages
kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic events --from-beginning
```

These commands assume Kafka is installed locally or accessible in your environment.
